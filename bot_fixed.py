import os
import random
import logging
from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup
from telegram.ext import Application, CommandHandler, CallbackQueryHandler, MessageHandler, filters, ContextTypes

# Настройка логирования
logging.basicConfig(
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    level=logging.INFO
)
logger = logging.getLogger(__name__)

# Токен бота
BOT_TOKEN = "7646237503:AAFF7hsMPqr4_66I6RNSu3IVm8sz2KC0S20"

class RuneBot:
    def __init__(self):
        self.runes = self.load_runes()
    
    def load_runes(self):
        """Загрузка базы рун"""
        runes = [
            {
            "name": "У-М",
            "title": "Ускорение",
            "meaning": "способствует быстрому старту в любых начинаниях, ускорение различных процессов, приближается наступление желаемых событий.",
            "image": "https://i.postimg.cc/4yQVZtH0/photo-5384064272784555335-y.jpg"
        },
        {
            "name": "Ви-Та",
            "title": "Вода",
            "meaning": "наполнение жизненной силой, восстановление, исцеление, позволяет быть мобильным, «обтекать» преграды на пути, находить быстрое решение.",
            "image": "https://i.postimg.cc/K8q7Rnpm/photo-5384064272784555375-y.jpg"
        },
        {
            "name": "Ды-Ды",
            "title": "Дыхание",
            "meaning": "насыщение энергией, открытие новых возможностей с благоприятной реализацией. Прежде чем что-то сказать – стоит подумать о том, стоит ли это говорить. Открывается «второе дыхание», восстановление работоспособности.",
            "image": "https://i.postimg.cc/9fDdTrsX/photo-5384064272784555371-y.jpg"
        },
        {
            "name": "Му-Ра",
            "title": "Сытость",
            "meaning": "удовлетворение духовных потребностей, притягивает помощников и проводников, способствующих реализации чего-либо. Содействие в исполнении желаний. Вас ждет насыщение в различных сферах жизни.",
            "image": "https://i.postimg.cc/PJjYBKJ1/photo-5384064272784555342-y.jpg"
        },
        {
            "name": "Ву-Ву",
            "title": "Внимание",
            "meaning": "отслеживание и считывание важных знаков Вселенной. Держите во внимании события, которые происходят вокруг, прислушивайтесь к интуиции.",
            "image": "https://i.postimg.cc/MGn7RvgV/photo-5384064272784555366-y.jpg"
        },
        {
            "name": "Доспехи Бога",
            "title": "Справедливость и защита",
            "meaning": "Справедливость и защита будут Вас сопровождать.",
            "image": "https://i.postimg.cc/DfrqqVpm/photo-5384064272784555330-y.jpg"
        },
        {
            "name": "Любовь-космос",
            "title": "Гармония бытия, совершенство, божественное начало",
            "meaning": "Обладает силой реализации и материализации. Направляет на духовный путь и открывает истину, налаживает связь с подсознанием и с Родом. Обретение уверенности в себе, избавление от застенчивости, наслаждение искренними эмоциями. Девиз руны – бескорыстие. Устранение дисгармонии и размолвок.",
            "image": "https://i.postimg.cc/0NzYmbh8/photo-5384064272784555372-y.jpg"
        },
        {
            "name": "Бррр",
            "title": "Солнечный Ветер",
            "meaning": "наполнение энергией Света и Радости, возвращение жизненных сил и энергии. Обеспечивает развитие, защиту и реализацию. «Вдохнуть жизнь» – кратко о функции этой руны.",
            "image": "https://i.postimg.cc/gcVvv9th/photo-5384064272784555329-y.jpg"
        },
        {
            "name": "Ми-На",
            "title": "Жертвенность",
            "meaning": "самоотверженность, щедрость, открытость, справедливость, мужество, стойкость, терпение, непривязанность к материальному миру. Преодоление любых препятствий, расширение сознания, трансформация.",
            "image": "https://i.postimg.cc/T1JgGm5S/photo-5384064272784555334-y.jpg"
        },
        {
            "name": "То-То",
            "title": "Полировка",
            "meaning": "доведение до совершенства любого действия, навыка, проекта и т.д. Помощь в достижении гармонии, сглаживание острых углов.",
            "image": "https://i.postimg.cc/7LjgNqy3/photo-5384064272784555364-y.jpg"
        },
        {
            "name": "И-У",
            "title": "Тяжесть",
            "meaning": "создание ощущения прочной опоры, сглаживание повышенную эмоциональность и лабильность. Помогает стабилизироваться и заземлиться, рекомендует не летать в облаках, а вернуться к делам насущным.",
            "image": "https://i.postimg.cc/tJjWLDJJ/photo-5384064272784555345-y.jpg"
        },
        {
            "name": "Ю-Ль",
            "title": "Достаток",
            "meaning": "счастье и изобилие, способствует росту и благоприятному развитию всех сфер жизни. Проявление возможностей для хороших заработков, раскрытие талантов. Защита от несчастий и нищеты.",
            "image": "https://i.postimg.cc/tTPFS8Xr/photo-5384064272784555356-y.jpg"
        },
        {
            "name": "У-Уш",
            "title": "Любовь",
            "meaning": "гармония, реализация и материализация. Открывает истину, помогает наладить союз с подсознанием. Направляет в поисках родственной души. Вдохновение, пробуждение искренних чувств. Способствует обретению уверенности в себе, целеустремленности. Помощь в поиске взаимопонимания с близкими и друзьями, советует принимать людей такими, какие они есть.",
            "image": "https://i.postimg.cc/KcPnnXpz/photo-5384064272784555331-y.jpg"
        },
        {
            "name": "А-Л",
            "title": "Ноль",
            "meaning": "перерождение, смена мировосприятия. Руна советует остудить эмоции и прийти к равновесию. Возможность построить все заново, обнуление негатива.",
            "image": "https://i.postimg.cc/mgX3tQpb/photo-5384064272784555374-y.jpg"
        },
        {
            "name": "Ма-Ба",
            "title": "Помощница",
            "meaning": "защита, подсказки, улучшение самочувствия, доведение дел до конца. Руна советует обратиться за помощью к помощнику, учителю или проводнику (с большой вероятностью женского пола) для решения той или иной задачи.",
            "image": "https://i.postimg.cc/YST1xtwd/photo-5384064272784555360-y.jpg"
        },
        {
            "name": "И-Щ",
            "title": "Оболочка",
            "meaning": "активизация способностей и сверхспособностей в человеке, соответствующие его потенциалам. Устранение пробоев, болезней, неудач. Стоит обратить внимание на то, достаточно ли хорошо оберегаются Ваши планы, идеи и проекты.",
            "image": "https://i.postimg.cc/0j0DxmKp/photo-5384064272784555340-y.jpg"
        },
        {
            "name": "Ма-Ма",
            "title": "Зарод",
            "meaning": "успешное рождение или зачатие ребенка. Импульс к созданию чего-то нового: дела, бизнеса, проекта и т.д. Помощь в развитии идей, наполнение энергией.",
            "image": "https://i.postimg.cc/Xqkd3FBD/photo-5384064272784555336-y.jpg"
        },
        {
            "name": "Ма-Ра",
            "title": "Разрушение",
            "meaning": "избавление от негативных блоков и установок, освобождение, трансформация, очищение тела и пространства для дальнейшего развития. Разрешение ситуации, которая долго не могла подойди к завершению, что принесёт облегчение. Разрушение ненужных связей и договоров. Устранение страхов, беспокойства и иллюзорных ожиданий",
            "image": "https://i.postimg.cc/d1dGHgsQ/photo-5384064272784555351-y.jpg"
        },
        {
            "name": "Ма-Ом",
            "title": "Разъединение",
            "meaning": "отказ от энергий, людей, стереотипов, привычек, которые мешают двигаться вперед. Важно проанализировать свои предыдущие действия и сделать определенные выводы. Отказ от пережитков прошлого и вступление в новую главу жизни.",
            "image": "https://i.postimg.cc/fbVcXJ1X/photo-5384064272784555368-y.jpg"
        },
        {
            "name": "Па-Ра",
            "title": "Помощник",
            "meaning": "защита, подсказки, улучшение самочувствия, доведение дел до конца. Руна советует обратиться за помощью к помощнику, учителю или проводнику (с большой вероятностью мужского пола) для решения той или иной задачи.",
            "image": "https://i.postimg.cc/KzLtqCGG/photo-5384064272784555352-y.jpg"
        },
        {
            "name": "Фи-Ша",
            "title": "Концентрация",
            "meaning": "привлечение средств, ресурсов, помощников, и проводников для быстрого достижения результатов. Сосредоточьтесь на приоритетной задаче и тогда сможете достичь цель. Помощь в реализации намерения. Проявление воли и работоспособности.",
            "image": "https://i.postimg.cc/MTR1Pg6K/photo-5384064272784555349-y.jpg"
        },
        {
            "name": "Трезубец",
            "title": "Трезубец",
            "meaning": "освобождение от внутренних привязок и оков. Помощь в осознании своего места в пространстве, возвращение чувства полноценности. Помощь решения проблем со здоровьем, усиление восприятий чувств счастья, любви и радости. Несет в себе функцию защиты, нейтрализует нападение.",
            "image": "https://i.postimg.cc/qqTy9Qq8/photo-5384064272784555344-y.jpg"
        },
        {
            "name": "И-На",
            "title": "Защита",
            "meaning": "защита от негатива, агрессии, магических атак. Не позволяйте недоброжелателям вторгаться в свое личное пространство. Будьте уверены в себе, отстранитесь от информационного шума, проследите чтобы не происходили утечки информации или денег.",
            "image": "https://i.postimg.cc/85WLKx1x/photo-5384064272784555353-y.jpg"
        },
{
    "name": "Ум-Ба",
    "title": "Радость",
    "meaning": "гармонизация отношений, привлечение второй половинки в Вашу жизнь. Импульс для решения различных задач. В скором времени случится подъем настроения, избавление от страхов и депрессий. Привлечение собеседников в Вашу жизнь.",
    "image": "https://i.postimg.cc/ZR367XTc/photo-5384064272784555357-y.jpg"
},
{
    "name": "У-Па",
    "title": "Замок",
    "meaning": "защита от вторжений недоброжелателей, закрепление действий и намерений. Скрепление союзов в бизнесе и в делах семейных. Защитите себя от влияния СМИ и зомбирующих программ, не увлекайтесь ими. Фиксирование результатов: закрепление сделки или решения.",
    "image": "https://i.postimg.cc/FzV3mcky/b19cc7cf-1b0b-49cf-95f2-0d7a846bdf96.jpg"
},
{
    "name": "Ва-Та",
    "title": "Вращение",
    "meaning": "застойные процессы придут в движение, усиление связи с природой и космосом. Структуризация планов и задач. Все события, которые находились в подвешенном состоянии, смогут гармонично выстроиться и сдвинутся с мертвой точки.",
    "image": "https://i.postimg.cc/DzRqc7Kp/photo-5384064272784555359-y.jpg"
},
{
    "name": "Уль-Уль",
    "title": "Наша Цивилизация",
    "meaning": "воссоединение с Родом, обретение помощи Предков. Духовное развитие, трансформация сознания. Активизация генетической памяти и родовых программ. Налаживание гармоничных отношений с родственниками и ушедшими душами, укрепление связи поколений. Помощь в поиске наилучшего решения и принятии правильного выбора.",
    "image": "https://i.postimg.cc/1t6DCbm3/photo-5384064272784555350-y.jpg"
},
{
    "name": "У-Даль",
    "title": "Путь",
    "meaning": "помощь в обретении жизненного пути, возможность узнать свое предназначение. Трансформация сознания и раскрытие духовности. Появятся подсказки для облегчения выбора в том или ином вопросе для принятия оптимального решения. Успех в поиске работы и жилья. Обретение второй половинки.",
    "image": "https://i.postimg.cc/x82MWg8C/photo-5384064272784555346-y.jpg"
},
{
    "name": "И-Ль",
    "title": "Восстановитель",
    "meaning": "восполнение дефицита энергии, гармонизация отношений в семье и в социуме. Ускорение выздоровления и восстановления организма. Активизация памяти. Обратите внимание на свое состояние, вероятно, Вам сейчас крайне необходим отдых.",
    "image": "https://i.postimg.cc/QC31RSCW/photo-5384064272784555343-y.jpg"
},
{
    "name": "Ва-Ра",
    "title": "Вечность",
    "meaning": "осознание, что смерть материального тела не влечёт за собой смерть души. Избавление от материальных привязанностей. Духовное развитие, пробуждение спящего сознания.",
    "image": "https://i.postimg.cc/kG3ZGm6d/photo-5384256446801246599-y.jpg"
},
{
    "name": "У-Ля",
    "title": "Ясно",
    "meaning": "ясность, вы будете видеть вещи такими, какие они есть, без прикрас. Уберите иллюзии и не обманывайте себя. Помощь в выборе правильного пути, в осознании себя и своего предназначения. Выход из «темноты», низковибрационных состояний, выявление обмана, прояснение ситуаций. Помощь в получении ответов.",
    "image": "https://i.postimg.cc/mrKQSTGk/photo-5384064272784555365-y.jpg"
},
{
    "name": "У-Ш",
    "title": "Рост",
    "meaning": "подключение к энергетическим и информационным потокам. Трансформация, совершенствование. Научитесь осознанности и проявите свои способности. Напоминание о том, что стоит поддерживать связь с Родом и Предками – корни важны. Олицетворение процветания, спокойствия, благодарности. Руна говорит о быстром развитии и раскрытии талантов. Увеличение силы и выносливости. Благоприятные условия для вынашивания и роста плода.",
    "image": "https://i.postimg.cc/q7W8Gpdw/photo-5384064272784555361-y.jpg"
},
{
    "name": "М-У",
    "title": "Рассеяние",
    "meaning": "рассеивание негативной энергетики, чужеродных программ и воздействия. Погаснут интриги и психологическое давление, сглаживание сценариев неприятных событий и их последствий. Выход из иллюзий. Советует избавиться от личных деструктивных мыслей, образов, страхов, лени и сомнений. Обратите внимание на воздействие и зомбирование СМИ, не подвержены ли вы влиянию и предрассудкам. Также возможно стоит провериться на наличие новообразований и проверить патогенную флору.",
    "image": "https://i.postimg.cc/3wzgZ3HV/photo-5384064272784555358-y.jpg"
},
{
    "name": "А-Ль",
    "title": "Равновесие",
    "meaning": "умиротворенность. Уравновесятся все аспекты быта, успокоится «маятник событий», жизнь перестанет кидать Вас из крайности в крайность. Нейтрализация каналов утечки энергии и предотвращение создания новых «дыр». Подавление болезненных и эмоциональных реакций, налаживание отношений в семье. Гармонизация пространства, уход от конфликтов. Не впадайте в крайности, избавьтесь от фанатизма, обретите умение владеть собой и быть сдержанней.",
    "image": "https://i.postimg.cc/d3Yrzn3v/photo-5384064272784555348-y.jpg"
},
{
    "name": "Му-Му",
    "title": "Разводящая",
    "meaning": "сделайте шаг вперед, не цепляйтесь за прошлое и не оглядывайтесь на него. Избавление от старых установок, программ, якорей, псевдодрузей и т.д. Прошлое должно остаться в прошлом, нужно двигаться дальше. Обратите внимание, вероятно, кто-то крадет у Вас энергию (энергетический вампир) и связь с этим человеком нужно прервать. Возможно, вам предстоит стать для кого-то проводником энергии или научить, как пользоваться Вселенскими источниками.",
    "image": "https://i.postimg.cc/sfYppFH5/photo-5384064272784555328-y.jpg"
},
{
    "name": "Ка-Ша",
    "title": "Целенаправленность",
    "meaning": "помощь в борьбе с ложными приоритетами, избавление от «розовых очков». Идите к цели, не рассеивайтесь по сторонам и не сбивайтесь с намеченного пути. Вам предстоит пройти путь самосовершенствования и освободиться. Рекомендует выстроить порядок задач по значимости, не перескакивайте на разные сложности, идите верно и постепенно. Содействие в распознании навязанных чужих целей и их устранение. Нейтрализация негативного влияния социума и окружения. Смена типа поведения, приводящая к радости и чувству удовлетворения от реализации планов. Повышение мотивации к действиям, обретите самоорганизованность, избавьтесь от лени и инертности.",
    "image": "https://i.postimg.cc/0yWGbpWh/photo_5384064272784555379_y.jpg"
},
{
    "name": "В-Иш",
    "title": "Ветер",
    "meaning": "движение вперед по истинному пути. Не бойтесь чего-то нежелательного и вредоносного, им до вас не добраться. Очищение тела и пространства, избавление от чего-то чужеродного. Снятие застоев и блоков. Произойдет мощный импульс, который запустит в движение процессы вокруг Вас. Охлаждение разума, снятие стресса, успокоение и наполнение силой. Не стойте на месте, вперед и только вперед.",
    "image": "https://i.postimg.cc/jjBzhRrQ/photo-5384064272784555363-y.jpg"
},
{
    "name": "Ва-Ва",
    "title": "Дождь",
    "meaning": "запуск процессов регенерации и возрождения. Импульс к развитию и росту, избавление от негативных программ, подключек, сущностей-паразитов. Возвращение красоты и здоровья, восстановление сил. Обратите внимание, Вам стоит отгородить себя от сомнительных связей. Очищение от последствий жизненных ошибок.",
    "image": "https://i.postimg.cc/Fz432Gzg/photo-5384064272784555341-y.jpg"
},
{
    "name": "М-А",
    "title": "Замедление",
    "meaning": "задержка и замораживание различных процессов. Сделайте передышку, приостановите ход мыслей, проведите внутренний диалог и погрузитесь в состояние покоя и равновесия. Обратите внимание на детали, принимайте только обдуманные и взвешенные решения. Не суетитесь. Приостанавливание процесса старения, гниения, окисления и разрушения. Позвольте себе растянуть удовольствие, насладитесь позитивными эмоциями.",
    "image": "https://i.postimg.cc/cCyjCSgZ/photo-5384256446801246600-y.jpg"
},
{
    "name": "Ви-Ра",
    "title": "Веденье",
    "meaning": "развитие способностей ясновиденья и яснознания. Обретение помощи в достижении осознанности. Вы увидите вещи такими, какие они есть, проявится ложь. Возможно, стоит обратить внимание на свои сны, они могут быть вещими. Вас может настичь озарение и произойдет некое открытие, что направит Вас в поиске, вы встретитесь с носителями ответов (человек, книга, статья, ресурс и т.д.). Помощь в правильном выборе в любых сферах. Обретите мудрость, наберитесь знаний и улучшите свои умения – это поможет завладеть ситуацией в Вашу пользу.",
    "image": "https://i.postimg.cc/90hZv10m/photo-5384064272784555347-y.jpg"
},
{
    "name": "Ом-Ма",
    "title": "Воссоединение",
    "meaning": "восстановление целостности, утерянных, разрушенных связей. Возвращение к Роду, к корням. Данная руна возвещает о скором возобновлении целостности отношений, примирении с близкими, любимыми и друзьями. После долгого времени набирания опыта, обогащения знаниями, прохождения уроков жизни все наконец-то встанет на свои места и «пазл сложится». Вы поймете, как Вам быть дальше, куда двигаться и что нужно делать.",
    "image": "https://i.postimg.cc/zB3tGQ2C/IMG-9495.avif"
},
{
    "name": "Ду-Ра",
    "title": "Трансформация",
    "meaning": "гармонизация тела и пространства, смена мышления и восприятия, подстраивание к новым энергиям. Вы встанете на путь реализации и предназначения, однако стоит научиться управлять своим внутренним миром и окружающей вас реальностью. Избавление от низкочастотных вибраций: злобы, зависти, гнева, обид, осуждения и пр. Смена негативных ситуаций позитивными.",
    "image": "https://i.postimg.cc/RZs1Ncp4/photo_5384064272784555376_y.jpg"
},
{
    "name": "Мир Линий",
    "title": "Нить",
    "meaning": "случайности не случайны. Все, что сейчас происходит с Вами и вокруг Вас, в итоге приведет к правильному развитию событий, что пойдет только на пользу. Научитесь слышать и слушать, помните, что мысли имеют форму. Прибавление энергии и силы, обретение твердой почвы под ногами. Информация, которая была Вам недоступна, скоро проявится. Рекомендуется посетить Место Силы для наполнения высокими вибрациями, Светом и силой (Кайлас, Эльбрус, Белуха, Северный полюс и др.).",
    "image": "https://i.postimg.cc/KYCn5my4/photo-5384064272784555367-y.jpg"
},
{
    "name": "Па-Па",
    "title": "Жезл",
    "meaning": "энергетический импульс для запуска процессов, творений, перемен и волшебства. Исполнение желаний. Берите ситуацию в свои руки, не спускайте на самотек. Вероятно, вам предстоит встретиться с человеком с большим потенциалом, но, возможно, пока нераскрывшимся. Если Вас поставили в пару работать с новым человеком, скорее всего, Вам предстоит поработать над его раскрытием.",
    "image": "https://i.postimg.cc/y8QhkFQt/photo_5384064272784555378_y.jpg"
},
{
    "name": "И-Ша",
    "title": "Мощность",
    "meaning": "обретение силы, проявление и улучшение способностей. Наполнение энергиями в ходе взаимодействия с различными источниками и каналами. Быстрая самореализация, усиление намерений. Ускорение и усиление различных процессов, стремительный старт в делах и начинаниях. Задайте себе направление для движения, определитесь с выбором пути.",
    "image": "https://i.postimg.cc/vm4r9cC1/photo-5384064272784555369-y.jpg"
},
{
    "name": "И-Рий",
    "title": "Реактор",
    "meaning": "преобразование. Откройтесь для любви и света. Разберитесь в ситуации, вместо суеты – начните разматывать клубок постепенно, найдите первоисточник проблем. Наполнение и восстановление, очищение и реализация. Вам не хватает баланса в душе и сознании, успокойтесь и действуйте неторопливо.",
    "image": "https://i.postimg.cc/4yQVZtHQ/photo-5384064272784555338-y.jpg"
},
{
    "name": "У-Ма",
    "title": "Победа",
    "meaning": "восстановление справедливости, трансформация сознания, пробуждение силы. Вам необходимо побороть темные проявления в душе, воздействия. Устранение мороков, иллюзий, подключек. Возвращение уверенности, устранение страхов, укрепление силы духа, твердости воли, совершенствование мастерства. Вам нужно бороться, в том числе и с самим собой, вредными привычками, привязанностями, ленью и тогда, несомненно, Вас ждет успех. Скрытные враги станут явными. Достижение цели, правильный выбор, преодоление неблагоприятных обстоятельств и преград. Победа над болезнью.",
    "image": "https://i.postimg.cc/3NFm7pDQ/photo-5384064272784555332-y.jpg"
},
{
    "name": "И-Ра",
    "title": "Помощь",
    "meaning": "помощь во всех начинаниях и делах, Вам окажут поддержку. Однако, Вам нужно определиться, с чем именно нужна помощь – все сразу объять не получится. Защита от негатива и обретение справедливости. Вы увидите и распознаете знаки Вселенной. Гармонизация души и разума. Взрастите в себе милосердие и сострадание, тогда намерения и обстоятельства повернутся в вашу пользу.",
    "image": "https://i.postimg.cc/rsXbsk02/photo-5384256446801246598-y.jpg"
},
{
    "name": "Ва-Ту",
    "title": "Дезинформация",
    "meaning": "ложь всплывет наружу. Вы избавитесь от иллюзорного восприятия действительности, увидите реальную суть вещей, избавитесь от интриг. Трансформация сознания, нейтрализация кукловодов, вредоносных и магических воздействий. Доверяйте себе, помните, что не стоит верить на слово всему, что сказано или написано другими. Главное – разобраться в ситуации и «отсеять зерна от плевел». Защитите себя от грязной информации и влияния СМИ. Выявление недобросовестных партнеров, продавцов, что в дальнейшем приведет к более плодотворным сделкам и переговорам. Нейтрализация нежелательных собеседников, устранение негатива, конфликтов, восстановление гармоничных отношений.",
    "image": "https://i.postimg.cc/VN2jFzcW/photo-5384064272784555362-y.jpg"
},
{
    "name": "И-Ри",
    "title": "Ключ",
    "meaning": "устранение блоков и препятствий, будет сделан правильный выбор и найдется решение. Нейтрализация замков, сделанных магическим путем. Перед Вами будут открыты знания и пути для достижения целей. Освобождение от различных уз, ограничений, чужих систем. Будут даны подсказки для выхода из трудных ситуаций. Возможно, выявятся причины болезней и нарушений, будут найдены средства и пути к исцелению.",
    "image": "https://i.postimg.cc/LXfjCGH7/photo-5384064272784555354-y.jpg"
},
{
    "name": "Ом-Уль",
    "title": "Защита Рода",
    "meaning": "обращение к помощи родственников и Рода. Позвольте им защитить Вас от разного рода влияний, установок, передать знания. Сохранение семейного очага и спокойствия, защита от злых чар, плодородие. Если сейчас в семье разлад, либо происходят другие проблемы (дети болеют, кто-то пристрастился к вредным привычкам, проблемы с финансами, нет взаимопонимания и уважения и др.) – род страдает и нужно как можно скорее решить эту проблему (в том числе магическим путем). Мы все дети Единого Рода, но у каждого есть своя родовая ветвь. Не стоит искать различий: будь то вера, культура, цвет кожи, национальность и т.д. Научитесь управлять своими мыслями и контролировать сознание.",
    "image": "https://i.postimg.cc/2ScdV4cP/photo_5384064272784555377_y.jpg"
},
{
    "name": "Ту-Ту",
    "title": "Пасмурно",
    "meaning": "пора отдохнуть и перевести дух для усвоения новой информации и наработок, а также восполнения энергии. Нужно восстановить силы и убрать лишние эмоции. Перемены будут проходить плавно и безболезненно. Остудите голову и присмотритесь к деталям, анализ и осмысление событий, обстоятельств и планов будет проходить планомерно и легко.",
    "image": "https://i.postimg.cc/rsNxcWt6/photo-5384064272784555333-y.jpg"
},
{
    "name": "И-Шу",
    "title": "Легкость",
    "meaning": "преодоление трудностей, снятие оков и привязок. Проявление и развитие способностей и талантов, повышение коммуникабельности и результативности. Облегчение усвоения информации и сдачи экзаменов. Позвольте себе снять усталость и напряжение, отдохните.",
    "image": "https://i.postimg.cc/SRfCq8YG/photo-5384064272784555337-y.jpg"
},
{
    "name": "Шу-Шу",
    "title": "Поток",
    "meaning": "помощь в подключении к запрашиваемым потокам и каналам, достижение и реализация целей. К Вам притянутся потоки изобилия, в том числе денежные. Застойные дела сдвинутся с мертвой точки, но имейте ввиду, что не стоит идти против течения. Будьте подвижны, но не срывайтесь с места в карьер, спонтанность и безрассудство – разные вещи, взвешивайте свои решения. Постарайтесь отгородиться от излишней суеты, забот и проблем.",
    "image": "https://i.postimg.cc/DZs1jR2p/photo-5384064272784555355-y.jpg"
},
{
    "name": "Вихрь",
    "title": "Разрушение всего устаревшего",
    "meaning": "избавление от эгрегориальных систем и вредоносных программ. Пространство вокруг Вас будет меняться и может показаться, что почва выбита из-под ног и все разрушено, однако, на самом деле это необходимая трансформация для дальнейшей перестройки событий и ситуаций. Окажите сопротивление силы, действующей извне и пытающейся Вас подавить, проявите силу духа и наберитесь терпения. События будут меняться быстро, успевайте реагировать.",
    "image": "https://i.postimg.cc/SKn68JHj/photo-5384064272784555370-y.jpg"
},
{
    "name": "И-Ла",
    "title": "Лед",
    "meaning": "«заморозка» процессов, ситуаций, энергии, событий. Остановка вредоносных программ, воздействия и деградации. Не торопитесь, осмотритесь, рассмотрите детали той или иной ситуации и будьте бдительны при считывании информации. Будьте тверды в решении различных вопросов и споров. Погасите эмоции, возбужденность ума, сохраняйте спокойствие и будьте хладнокровны.",
    "image": "https://i.postimg.cc/8cQ3cSJS/photo-5384256446801246592-y.jpg"
},
{
    "name": "Ды-Ра",
    "title": "Огонь",
    "meaning": "источник жизни, силы и знаний. Трансформация энергии, материи и сознания. Вас ждет материализация и программирование задуманных событий. Учитесь управлять своей жизненной энергией, не давайте огню внутри Вас потухнуть. Разжигание страсти и желания, а также поддержка и защита домашнего очага, укрепление отношений. Говорит о том, что пора избавиться от пагубных привычек и влияния извне.",
    "image": "https://i.postimg.cc/xdXvHchw/photo-5384064272784555373-y.jpg"
}
    # ... добавьте остальные руны
]
        return runes
    
    def get_random_rune(self):
        """Получение случайной руны"""
        return random.choice(self.runes)

# Инициализация бота
bot = RuneBot()

async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """Обработчик команды /start"""
    user = update.effective_user
    
    logger.info(f"👤 Пользователь запустил бота: {user.id} (@{user.username})")
    
    await show_main_menu(update, context, user.first_name)

async def show_main_menu(update, context, first_name):
    """Показать главное меню"""
    keyboard = [
        [InlineKeyboardButton("🎴 Вытянуть руну", callback_data="draw_rune")],
        [InlineKeyboardButton("📖 Как правильно задавать вопрос", callback_data="how_to_ask")],
        [InlineKeyboardButton("ℹ️ О боте", callback_data="about")]
    ]
    
    reply_markup = InlineKeyboardMarkup(keyboard)
    
    if hasattr(update, 'message'):
        await update.message.reply_text(
            f"🕊️ Добро пожаловать, {first_name}!\n\n"
            "✨ *Бот рун - ваш проводник в мир мудрости и интуиции*\n\n"
            "Здесь вы можете получить совет от Вселенной через древние символы рун.",
            parse_mode='Markdown',
            reply_markup=reply_markup
        )
    else:
        await update.edit_message_text(
            f"🕊️ Добро пожаловать, {first_name}!\n\n"
            "✨ *Бот рун - ваш проводник в мир мудрости и интуиции*\n\n"
            "Здесь вы можете получить совет от Вселенной через древние символы рун.",
            parse_mode='Markdown',
            reply_markup=reply_markup
        )

async def button_handler(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """Обработчик нажатий на кнопки"""
    query = update.callback_query
    await query.answer()
    
    data = query.data
    
    logger.info(f"🔘 Нажата кнопка: {data} пользователем {query.from_user.id}")
    
    if data == "draw_rune":
        await draw_rune(query, context)
    elif data == "how_to_ask":
        await how_to_ask(query, context)
    elif data == "about":
        await show_about(query, context)
    elif data == "back_to_menu":
        await show_main_menu(query, context, query.from_user.first_name)

async def draw_rune(query, context):
    """Вытягивание случайной руны"""
    try:
        rune = bot.get_random_rune()
        
        logger.info(f"Выбрана руна: {rune['name']}")
        logger.info(f"URL изображения: {rune['image']}")
        
        # Сначала редактируем сообщение с меню
        await query.edit_message_text(
            "🔄 *Вытягиваю руну...*",
            parse_mode='Markdown'
        )
        
        # Добавляем небольшую задержку для стабильности
        import asyncio
        await asyncio.sleep(1)
        
        # Пробуем отправить текст сначала, без изображения
        await query.message.reply_text(
            f"🛡️ *Вам выпала руна:* {rune['name']} - {rune['title']}*\n\n"
            f"📖 *Значение:*\n{rune['meaning']}\n\n"
            "✨ *Прислушайтесь к этому знаку и доверьтесь мудрости Вселенной!",
            parse_mode='Markdown'
        )
        
        # Затем пробуем отправить изображение отдельно
        try:
            await query.message.reply_photo(
                photo=rune["image"],
                caption=f"🛡️ *Руна {rune['name']}*"
            )
        except Exception as photo_error:
            logger.error(f"Ошибка при отправке фото: {photo_error}")
            await query.message.reply_text(
                "📷 *Изображение руны временно недоступно*\n"
                "Но мудрость руны все равно с вами!",
                parse_mode='Markdown'
            )
        
        # Отправляем меню
        await query.message.reply_text(
            "✨ *Руна выбрана!*\n\n"
            "Задумайтесь о своем вопросе и позвольте мудрости руны направлять вас.",
            parse_mode='Markdown',
            reply_markup=InlineKeyboardMarkup([
                [InlineKeyboardButton("🎴 Вытянуть еще одну руну", callback_data="draw_rune")],
                [InlineKeyboardButton("📖 Как задавать вопросы", callback_data="how_to_ask")],
                [InlineKeyboardButton("🔙 На главную", callback_data="back_to_menu")]
            ])
        )
        
    except Exception as e:
        logger.error(f"Ошибка при вытягивании руны: {e}", exc_info=True)
        await query.edit_message_text(
            "❌ *Произошла ошибка при вытягивании руны*\n\n"
            "Попробуйте еще раз через несколько секунд.",
            parse_mode='Markdown',
            reply_markup=InlineKeyboardMarkup([
                [InlineKeyboardButton("🔄 Попробовать снова", callback_data="draw_rune")],
                [InlineKeyboardButton("🔙 На главную", callback_data="back_to_menu")]
            ])
        )

async def how_to_ask(query, context):
    """Информация о том, как правильно задавать вопросы"""
    advice_text = (
        "📖 *Как правильно задавать вопрос рунам:*\n\n"
        
        "1. **Сосредоточьтесь**\n"
        "   Перед вытягиванием руны найдите тихое место, где вас никто не побеспокоит. Сделайте несколько глубоких вдохов и выдохов.\n\n"
        
        "2. **Сформулируйте вопрос**\n"
        "   Будьте конкретны, но оставляйте пространство для интерпретации. Примеры хороших вопросов:\n"
        "   • «Что мне важно знать о текущей ситуации?»\n"
        "   • «Какой путь будет наилучшим для моего развития?»\n"
        "   • «На что мне обратить внимание в ближайшее время?»\n\n"
        
        "3. **Доверьтесь интуиции**\n"
        "   Не пытайтесь анализировать руну логически. Позвольте первому впечатлению и чувствам говорить с вами.\n\n"
        
        "4. **Будьте открыты**\n"
        "   Руны могут дать ответ, который вы не ожидаете. Будьте готовы принять любую мудрость.\n\n"
        
        "5. **Помните**\n"
        "   Руны Русичей - это язык общения с Высшими силами, Родными Богами и Предками. Это язык Света и Образов. Не стоит сводить это к гаданию, к заглядыванию в будущее.\n\n"
        
        "✨ *Помните:* руны — это проводник, а не предсказание судьбы. Они показывают потенциал и направление."
    )
    
    await query.edit_message_text(
        advice_text,
        parse_mode='Markdown',
        reply_markup=InlineKeyboardMarkup([
            [InlineKeyboardButton("🎴 Вытянуть руну", callback_data="draw_rune")],
            [InlineKeyboardButton("🔙 На главную", callback_data="back_to_menu")]
        ])
    )

async def show_about(query, context):
    """Информация о боте"""
    about_text = (
        "📚 *Бот рун - бесплатный проводник в мир мудрости*\n\n"
        
        "✨ *О рунах:*\n"
        "Руны — это древние символы, несущие в себе мудрость поколений. "
        "Каждая руна имеет свое уникальное значение и энергетику, помогая нам "
        "получить ответы на важные вопросы и найти правильный путь.\n\n"
        
        "🆓 *Бесплатный доступ:*\n"
        "Этот бот создан для того, чтобы каждый мог получить мудрый совет Вселенной. "
        "Никаких оплат, подписок или ограничений — только чистая энергия и мудрость рун.\n\n"
        
        "🌌 *Как работает бот:*\n"
        "1. Вы задаете вопрос (мысленно или вслух)\n"
        "2. Вытягиваете случайную руну\n"
        "3. Получаете мудрый ответ и guidance\n\n"
        
        "💫 *Доверяйте процессу и позвольте магии рун направлять вас!*"
    )
    
    await query.edit_message_text(
        about_text,
        parse_mode='Markdown',
        reply_markup=InlineKeyboardMarkup([
            [InlineKeyboardButton("🎴 Вытянуть руну", callback_data="draw_rune")],
            [InlineKeyboardButton("📖 Как задавать вопросы", callback_data="how_to_ask")],
            [InlineKeyboardButton("🔙 На главную", callback_data="back_to_menu")]
        ])
    )

async def handle_message(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """Обработка текстовых сообщений"""
    user_id = update.effective_user.id
    text = update.message.text.strip()
    
    logger.info(f"💬 Сообщение от {user_id}: {text}")
    
    # Обработка команды /start
    if text == '/start':
        return
    
    # Ответ на обычные сообщения
    await update.message.reply_text(
        "✨ Используйте кнопки меню для навигации.\n\n"
        "Если меню пропало, отправьте /start",
        reply_markup=InlineKeyboardMarkup([
            [InlineKeyboardButton("🔄 Открыть меню", callback_data="back_to_menu")]
        ])
    )

async def error_handler(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """Обработчик ошибок"""
    logger.error(f"Ошибка: {context.error}")

def main():
    """Запуск бота"""
    try:
        application = Application.builder().token(BOT_TOKEN).build()
        
        # Добавляем обработчики
        application.add_handler(CommandHandler("start", start))
        application.add_handler(CallbackQueryHandler(button_handler))
        application.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, handle_message))
        application.add_error_handler(error_handler)
        
        print("🛡️ Бот рун запущен!")
        print("✨ Теперь открыт для всех пользователей бесплатно!")
        print("🌐 Ожидаю сообщения...")
        
        application.run_polling()
        
    except Exception as e:
        logger.error(f"Критическая ошибка при запуске: {e}")
        print(f"❌ Ошибка запуска: {e}")

if __name__ == '__main__':
    main()